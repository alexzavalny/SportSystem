<!doctype html>
<html>
    <head>
        <title>Zavalny Sport System</title>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="apple-mobile-web-app-title" content="Sport Tracker" />
        <link rel="apple-touch-icon" href="icons/icon-192x192.png" />

        <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", function () {
                    navigator.serviceWorker.register("/sw.js").then(
                        function (registration) {
                            console.log(
                                "ServiceWorker registration successful with scope: ",
                                registration.scope,
                            );
                        },
                        function (err) {
                            console.log(
                                "ServiceWorker registration failed: ",
                                err,
                            );
                        },
                    );
                });
            }
        </script>

        <link
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            input {
                margin-left: 5px;
            }
            .language-ru {
                display: none;
            }
            @media (max-width: 600px) {
                h1 {
                    font-size: 1.5em;
                }
                h2 {
                    font-size: 1.2em;
                }
                .table th,
                .table td {
                    padding: 0.5rem;
                }
                button {
                    width: 49%;
                    margin-bottom: 10px;
                }
                input[type="checkbox"] {
                    margin-left: 2;
                }
            }
        </style>
    </head>
    <body class="container">
        <h1 class="text-center my-4">
            <span class="language-en">Zavalny Sport System</span>
            <span class="language-ru">Спортивная Система Завального</span>
        </h1>
        <div class="text-center mb-4">
            <span class="language-en">Today is day</span>
            <span class="language-ru">Сегодня день</span>
            <span id="debug"></span>
            <script>
                function dayOfYear(date) {
                    const start = new Date(date.getFullYear(), 0, 0);
                    const diff = date - start;
                    const oneDay = 1000 * 60 * 60 * 24;
                    const day = Math.floor(diff / oneDay);
                    return day;
                }

                var d = new Date();
                var n = dayOfYear(d) % 3;
                document.write(n);
            </script>
        </div>

        <button onclick="switchLanguage('en')">English</button>
        <button onclick="switchLanguage('ru')">Русский</button>

        <h2 class="mt-4">
            <span class="language-en">Day 1</span>
            <span class="language-ru">День 1</span>
        </h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>
                        <span class="language-en">Sets</span
                        ><span class="language-ru">Сеты</span>
                    </th>
                    <th>
                        <span class="language-en">Priority</span
                        ><span class="language-ru">Приоритет</span>
                    </th>
                    <th>
                        <span class="language-en">Home exercise</span
                        ><span class="language-ru">Домашнее упражнение</span>
                    </th>
                    <th>
                        <span class="language-en">Gym alternative</span
                        ><span class="language-ru">Альтернатива в зале</span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input type="checkbox" id="day1-set1" /><input
                            type="checkbox"
                            id="day1-set2"
                        /><input type="checkbox" id="day1-set3" />
                    </td>
                    <td>
                        <span class="language-en">Must</span
                        ><span class="language-ru">Обязательно</span>
                    </td>
                    <td>
                        <span class="language-en">Push-ups</span
                        ><span class="language-ru">Отжимания</span>
                    </td>
                    <td>
                        <span class="language-en">Bench press</span
                        ><span class="language-ru">Жим лёжа</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day1-set4" /><input
                            type="checkbox"
                            id="day1-set5"
                        /><input type="checkbox" id="day1-set6" />
                    </td>
                    <td>
                        <span class="language-en">Must</span
                        ><span class="language-ru">Обязательно</span>
                    </td>
                    <td>
                        <span class="language-en">Squats / Lunges</span
                        ><span class="language-ru">Приседания / Лангс</span>
                    </td>
                    <td>
                        <span class="language-en">Leg Press</span
                        ><span class="language-ru">Жим ногами</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day1-set7" /><input
                            type="checkbox"
                            id="day1-set8"
                        /><input type="checkbox" id="day1-set9" />
                    </td>
                    <td>
                        <span class="language-en">Should</span
                        ><span class="language-ru">Желательно</span>
                    </td>
                    <td>
                        <span class="language-en">Dips</span
                        ><span class="language-ru">Брусья</span>
                    </td>
                    <td>
                        <span class="language-en">Triceps Push</span
                        ><span class="language-ru">Трицепс Жим</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day1-set10" /><input
                            type="checkbox"
                            id="day1-set11"
                        /><input type="checkbox" id="day1-set12" />
                    </td>
                    <td>
                        <span class="language-en">Can</span
                        ><span class="language-ru">Опционально</span>
                    </td>
                    <td>
                        <span class="language-en">Pike Pushups</span
                        ><span class="language-ru">Пайк Отжимания</span>
                    </td>
                    <td>
                        <span class="language-en">Should Press</span
                        ><span class="language-ru">Жим плечами</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <h2 class="mt-4">
            <span class="language-en">Day 2</span>
            <span class="language-ru">День 2</span>
        </h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>
                        <span class="language-en">Sets</span
                        ><span class="language-ru">Сеты</span>
                    </th>
                    <th>
                        <span class="language-en">Priority</span
                        ><span class="language-ru">Приоритет</span>
                    </th>
                    <th>
                        <span class="language-en">Home exercise</span
                        ><span class="language-ru">Домашнее упражнение</span>
                    </th>
                    <th>
                        <span class="language-en">Gym alternative</span
                        ><span class="language-ru">Альтернатива в зале</span>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input type="checkbox" id="day2-set1" /><input
                            type="checkbox"
                            id="day2-set2"
                        /><input type="checkbox" id="day2-set3" />
                    </td>
                    <td>
                        <span class="language-en">Must</span
                        ><span class="language-ru">Обязательно</span>
                    </td>
                    <td>
                        <span class="language-en">Pull ups</span
                        ><span class="language-ru">Подтягивания</span>
                    </td>
                    <td>
                        <span class="language-en">Lat Pulldowns</span
                        ><span class="language-ru">Тяга сверху</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day2-set4" /><input
                            type="checkbox"
                            id="day2-set5"
                        /><input type="checkbox" id="day2-set6" />
                    </td>
                    <td>
                        <span class="language-en">Must</span
                        ><span class="language-ru">Обязательно</span>
                    </td>
                    <td>
                        <span class="language-en">Leg Raises</span
                        ><span class="language-ru">Подъемы ног</span>
                    </td>
                    <td>
                        <span class="language-en">Abs Crunches</span
                        ><span class="language-ru">Скручивания</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day2-set7" /><input
                            type="checkbox"
                            id="day2-set8"
                        /><input type="checkbox" id="day2-set9" />
                    </td>
                    <td>
                        <span class="language-en">Should</span
                        ><span class="language-ru">Желательно</span>
                    </td>
                    <td>
                        <span class="language-en">Australian Pullups</span
                        ><span class="language-ru"
                            >Австралийские подтягивания</span
                        >
                    </td>
                    <td>
                        <span class="language-en">Cable Pulls</span
                        ><span class="language-ru">Тяга троса</span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="checkbox" id="day2-set10" /><input
                            type="checkbox"
                            id="day2-set11"
                        /><input type="checkbox" id="day2-set12" />
                    </td>
                    <td>
                        <span class="language-en">Can</span
                        ><span class="language-ru">Опционально</span>
                    </td>
                    <td>
                        <span class="language-en">Biceps Curls</span
                        ><span class="language-ru">Сгибание на бицепс</span>
                    </td>
                    <td>
                        <span class="language-en">Biceps Curls</span
                        ><span class="language-ru">Сгибание на бицепс</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <h2 class="mt-4">
            <span class="language-en">Day 0</span>
            <span class="language-ru">День 0</span>
        </h2>
        <p>
            <span class="language-en">Rest or debts</span>
            <span class="language-ru">Отдых или долги</span>
        </p>

        <script>
            function switchLanguage(language) {
                localStorage.setItem("selectedLanguage", language);
                const enElements = document.querySelectorAll(".language-en");
                const ruElements = document.querySelectorAll(".language-ru");
                if (language === "en") {
                    enElements.forEach((el) => (el.style.display = "inline"));
                    ruElements.forEach((el) => (el.style.display = "none"));
                } else {
                    enElements.forEach((el) => (el.style.display = "none"));
                    ruElements.forEach((el) => (el.style.display = "inline"));
                }
            }

            // Function to save checkbox state to localStorage
            function saveCheckboxState(checkbox) {
                const date = new Date().toISOString().slice(0, 10);
                const id = checkbox.id;
                const key = `${date}__${id}`;
                localStorage.setItem(key, checkbox.checked);
            }

            // Function to restore checkbox state from localStorage
            function restoreCheckboxState() {
                const checkboxes = document.querySelectorAll(
                    'input[type="checkbox"]',
                );

                const date = new Date();
                const today = date.toISOString().slice(0, 10);

                date.setDate(date.getDate() - 1);
                const yesterday = date.toISOString().slice(0, 10);

                checkboxes.forEach((checkbox) => {
                    const id = checkbox.id;
                    const today_key = `${today}__${id}`;
                    const yesterday_key = `${yesterday}__${id}`;
                    const today_value = localStorage.getItem(today_key);
                    const yesterday_value = localStorage.getItem(yesterday_key);
                    if (today_value === "true" || yesterday_value == "true") {
                        checkbox.checked = true;

                        if (yesterday_value == "true") {
                            // make checkbox readonly
                            checkbox.disabled = true;
                        }
                    }
                });
            }

            // Function to restore selected language from localStorage
            function restoreLanguage() {
                const selectedLanguage =
                    localStorage.getItem("selectedLanguage") || "en";
                switchLanguage(selectedLanguage);
            }

            // Add event listeners to checkboxes to save their state on change
            document.addEventListener("DOMContentLoaded", () => {
                //set current date time to span with id=debug
                document.getElementById("debug").innerHTML =
                    new Date().toISOString();

                restoreCheckboxState();
                restoreLanguage();
                const checkboxes = document.querySelectorAll(
                    'input[type="checkbox"]',
                );
                checkboxes.forEach((checkbox) => {
                    checkbox.addEventListener("change", (e) => {
                        saveCheckboxState(e.target);
                    });
                });
            });
        </script>
    </body>
</html>
